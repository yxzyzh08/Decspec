# Design Node: Safety Principles
# Defines the Git-based ratcheting mechanism for safe evolution

id: des_safety
type: design
name: "Safety Principles"
source_anchor: "PRD.md#des_safety"
intent: "定义基于 Git 的棘轮机制，确保系统进化的安全性和可回滚性。"

rationale: |
  自举系统 (Self-Bootstrapping System) 面临特殊风险：
  - 生成的代码可能破坏工具自身
  - 错误可能级联放大
  - 需要可靠的回滚机制

  Git 天然提供了版本控制和回滚能力，将其建模为"棘轮"可以确保：
  - 只有验证通过的版本才能成为基准
  - 失败时可以安全回退
  - 进化过程有迹可循

principles:
  - name: "Git-Based Ratcheting"
    desc: "系统进化像棘轮一样单向锁定，只有验证通过才能前进。"
    why: "防止自举过程中的级联失败，确保总有可用的回退点。"

  - name: "Genesis Kernel"
    desc: "只有经过验证的、能成功编译自身的版本，才能被 Tag 为基准版本。"
    why: "确保基准版本的可靠性，为回滚提供安全锚点。"

  - name: "Rollback Protocol"
    desc: "当进化失败时，通过 git checkout 回退到上一个 Genesis Tag，而不是原地修补。"
    why: "原地修补可能引入更多问题，干净回滚更安全。"

verification_criteria:
  - criterion: "CLI 可启动"
    command: "uv run devspec --help"
    expected: "显示帮助信息，无错误"

  - criterion: "核心命令可执行"
    command: "uv run devspec monitor"
    expected: "生成 Dashboard，无崩溃"

  - criterion: "自我验证通过"
    command: "uv run devspec validate-prd"
    expected: "PRD 格式校验通过"

tag_convention:
  format: "v{major}.{minor}.{patch}-genesis"
  example: "v0.1.0-genesis"
  desc: "Genesis 标签表示经过验证的安全回退点"
