meta:
  id: "feat_code_scan"
  type: "Feature"
  domain: "dom_core"
  status: "PLANNED"
  priority: "P1"
  realized_by: []

intent:
  summary: "实现 L3 代码自动索引 (Tree-sitter)"
  user_story: |
    作为开发者，我希望系统能自动扫描源代码，提取函数/类定义，
    生成 L3 层索引，以便 AI 能了解代码结构而无需手动维护。

contract:
  input: "CLI command: `devspec scan [--path <source_dir>]`"
  output: |
    - 更新数据库中的 Function 节点
    - 输出扫描统计：文件数、函数数、类数

workflow:
  - step: 1
    name: "Configure Source Paths"
    desc: "从配置或参数获取要扫描的源代码目录"

  - step: 2
    name: "Parse with Tree-sitter"
    desc: "使用 tree-sitter-python 解析 .py 文件"

  - step: 3
    name: "Extract Symbols"
    desc: "提取函数定义、类定义、方法签名"

  - step: 4
    name: "Store L3 Nodes"
    desc: "将提取的符号作为 Function 类型节点存入数据库"

  - step: 5
    name: "Link to Components"
    desc: "根据文件路径关联到对应的 Component 节点"

dependencies:
  - "feat_specindex_sync"

tech_notes: |
  - 使用 tree-sitter 库进行语法解析
  - 初期仅支持 Python，后续可扩展其他语言
  - L3 节点应标记为自动生成，避免与手动定义混淆
