meta:
  id: "feat_specindex_sync"
  type: "Feature"
  domain: "dom_core"
  status: "DONE"
  realized_by:
    - "comp_specgraph_engine"

intent:
  summary: "实现 SpecGraph 同步引擎 (YAML -> SQLite)"
  user_story: "作为系统，我需要将文件系统中的 YAML 定义解析并存储到 SQLite 数据库中，以便进行快速的关系查询和反向索引。"

contract:
  input: "CLI command: `devspec sync`"
  output: "A populated SQLite database at `.specgraph/.runtime/index.db`"

workflow:
  - step: 1
    name: "Define Models"
    desc: "Create SQLModel classes for Node and Edge in `devspec/core/db_models.py`."
  
  - step: 2
    name: "Init DB"
    desc: "Ensure `.specgraph/.runtime/` exists and create tables."
  
  - step: 3
    name: "Traverse YAMLs"
    desc: "Walk through `features/`, `apis/`, `components/` directories."
  
  - step: 4
    name: "Ingest Nodes"
    desc: "Insert YAML content into `nodes` table. Extract `search_text` for FTS."
  
  - step: 5
    name: "Ingest Edges"
    desc: "Parse `dependencies`, `realized_by` fields in YAML and insert into `edges` table."