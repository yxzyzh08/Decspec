# Component Definition: CLI App
# Part of feat_cli_command_structure
# Validated against sub_meta_schema.yaml

id: comp_cli_app
type: module
desc: "Typer 应用主入口，负责命令注册、全局配置和子命令分发。"
source_anchor: "PRD.md#comp_cli_app"
file_path: "devspec/main.py"

tech_stack:
  - typer
  - rich

dependencies:
  - comp_cli_debug_logger  # For CLI debug mode support
  - comp_config_manager     # For configuration and debug mode detection

# === 详细设计 (Design) ===
design:
  api:
    - signature: "app: typer.Typer"
      desc: "主 Typer 应用实例，作为 CLI 入口点"
    - signature: "def main() -> None"
      desc: "应用入口函数，由 pyproject.toml 的 [project.scripts] 调用"
      params: []
      returns:
        type: "None"
        desc: "无返回值"

  logic: |
    1. 创建 Typer 应用实例 app = typer.Typer()
    2. 添加全局 --debug 选项 (通过 Typer callback)
    3. 应用启动时加载配置:
       3.1 调用 load_env_file() 加载 .env 文件 (如果存在)
       3.2 初始化 ConfigManager
    4. 判断是否启用 Debug 模式:
       4.1 调用 get_debug_mode(cli_flag=--debug 参数值)
       4.2 优先级: CLI 参数 > .env 文件 > 默认 False
    5. 如果 Debug 模式启用:
       5.1 初始化 CLIDebugLogger
       5.2 为所有注册的命令添加 debug_command 装饰器
    6. 注册子命令 (init, monitor, validate-prd, sync 等)
    7. main() 函数调用 app() 启动 CLI
