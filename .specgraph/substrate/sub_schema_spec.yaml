meta:
  id: "sub_schema_spec"
  type: "Substrate"
  scope: ["all"]  # 这份文档本身也是全局规范

content: |
  # YAML Metadata Specification (The "Meta" Field)

  Every YAML file in SpecGraph MUST contain a `meta` block.
  This document defines how the system interprets these fields.

  ## 1. `type` (The Identity)
  Defines the structure and role of the file.
  - **Product**: The global root view. Has `info`, `references`, `domains`.
  - **Design**: Architecture/philosophy documents. Has `content`.
  - **Feature**: A task unit (L1). Has `intent`, `contract`, `workflow`.
  - **Component**: An implementation unit (L2). Has `impl`, `modules`.
  - **DataModel**: Data entity definition (L2).
  - **Substrate**: A rule/standard (L0). Has `content`. Injected into Context based on `scope`.
  - **API**: An interface contract (L2).

  ## 2. `scope` (The Visibility)
  ONLY used in `Substrate` type. Controls when the rule is injected into the AI context.
  - **Logic**:
    - If `scope` contains `"all"`: Always inject this rule.
    - If `scope` contains a specific `domain_id` (e.g., "dom_cli"): Only inject when the current task belongs to that domain.
    - If `scope` contains a specific tag (e.g., "backend"): Only inject when task involves backend.

  ## 3. `domain` (The Ownership)
  Used in `Feature` and `Component` types. Links to a Domain in `product.yaml`.

  ## 4. `status` (The Lifecycle)
  - `DRAFT`: Planning phase.
  - `PLANNED`: Approved but not started.
  - `IN_PROGRESS`: Currently being implemented.
  - `DONE`: Implementation completed.
  - `ARCHIVED`: Deprecated.

  ## 5. `prd_ref` (PRD Traceability) [NEW]
  Used in `Design` type. Links back to the original PRD section.
  - **Format**: `"filename.md#section"` (e.g., `"standerd_req.md#1.2"`)
  - **Purpose**: Enable bidirectional traceability between PRD and SpecGraph.

  ## 6. `references` (Document Index) [NEW]
  ONLY used in `Product` type. Maps key concepts to their detailed documents.
  - **Purpose**: PRD is "scattered" into multiple YAML files; this provides an index.
  - **Example**:
    ```yaml
    references:
      philosophy: "design/des_philosophy.yaml"
      roadmap: "design/des_roadmap.yaml"
    ```

  ## 7. `realized_by` (Implementation Link)
  Used in `Feature` type. Links to Component(s) that implement this feature.
  - **Purpose**: Feature → Component traceability.
  - **Rule**: If empty, AI must NOT write code until Component design is complete.