{% extends "base.html" %}

{% block title %}{{ node.name }} - SpecGraph Viewer{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <!-- Node Header -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-6 border-l-4 node-{{ node.type }}">
    <div class="flex items-start justify-between">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">{{ node.name }}</h1>
        <p class="text-gray-500 mt-1">{{ node.id }}</p>
        <span class="inline-block mt-2 px-3 py-1 text-sm rounded-full
          {% if node.type == 'feature' %}bg-blue-100 text-blue-700
          {% elif node.type == 'component' %}bg-green-100 text-green-700
          {% elif node.type == 'domain' %}bg-purple-100 text-purple-700
          {% else %}bg-gray-100 text-gray-700{% endif %}">
          {{ node.type }}
        </span>
      </div>
      <a href="/relation/node/{{ node.id }}" class="text-blue-600 hover:underline text-sm">
        查看依赖关系 →
      </a>
    </div>
  </div>

  <!-- Content Sections -->
  <div class="space-y-4">
    {% if node.intent %}
    <details open class="bg-white rounded-lg shadow-md">
      <summary class="cursor-pointer px-6 py-4 font-semibold text-gray-800 hover:bg-gray-50 rounded-t-lg">
        Intent
      </summary>
      <div class="px-6 pb-4 text-gray-700">
        {{ node.intent }}
      </div>
    </details>
    {% endif %}

    {% if node.description %}
    <details open class="bg-white rounded-lg shadow-md">
      <summary class="cursor-pointer px-6 py-4 font-semibold text-gray-800 hover:bg-gray-50 rounded-t-lg">
        Description
      </summary>
      <div class="px-6 pb-4 text-gray-700 whitespace-pre-line">
        {{ node.description }}
      </div>
    </details>
    {% endif %}

    {% if node.file_path %}
    <details open class="bg-white rounded-lg shadow-md">
      <summary class="cursor-pointer px-6 py-4 font-semibold text-gray-800 hover:bg-gray-50 rounded-t-lg">
        File Path
      </summary>
      <div class="px-6 pb-4">
        <code class="bg-gray-100 px-3 py-1 rounded text-sm">{{ node.file_path }}</code>
      </div>
    </details>
    {% endif %}

    {% if node.source_anchor %}
    <details class="bg-white rounded-lg shadow-md">
      <summary class="cursor-pointer px-6 py-4 font-semibold text-gray-800 hover:bg-gray-50 rounded-t-lg">
        Source Anchor
      </summary>
      <div class="px-6 pb-4">
        <code class="bg-gray-100 px-3 py-1 rounded text-sm">{{ node.source_anchor }}</code>
      </div>
    </details>
    {% endif %}

    <!-- Relations -->
    {% if depends_on or realized_by or depended_by %}
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="font-semibold text-gray-800 mb-4">关联节点</h2>

      {% if depends_on %}
      <div class="mb-4">
        <h3 class="text-sm font-medium text-gray-600 mb-2">Depends On</h3>
        <div class="flex flex-wrap gap-2">
          {% for item in depends_on %}
          <a href="/hierarchy/node/feature/{{ item.id }}" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200">
            {{ item.name }}
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if realized_by %}
      <div class="mb-4">
        <h3 class="text-sm font-medium text-gray-600 mb-2">Realized By</h3>
        <div class="flex flex-wrap gap-2">
          {% for item in realized_by %}
          <a href="/hierarchy/node/component/{{ item.id }}" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200">
            {{ item.name }}
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      {% if depended_by %}
      <div>
        <h3 class="text-sm font-medium text-gray-600 mb-2">Depended By</h3>
        <div class="flex flex-wrap gap-2">
          {% for item in depended_by %}
          <a href="/hierarchy/node/feature/{{ item.id }}" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200">
            {{ item.name }}
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
